# Standup: 2025-01-08

## Completed

### Tool Calling Module (Plan 001)
- Created unified `toolcall.py` module (~500 lines) with:
  - `ToolCallHandler` singleton for parsing tool calls
  - `JsonCleaner` for fixing malformed LLM JSON output
  - `FormatParser` with auto-detection for 6 formats
- Implemented parsers for all formats:
  - CONTRACT: `{"type": "tool_call", ...}`
  - OPENAI: `{"type": "function", ...}`
  - HERMES: `<tool_call>...</tool_call>`
  - LLAMA3: `[func(arg=val)]`
  - MISTRAL: `[TOOL_CALLS] [...]`
  - NATIVE: llama-cpp-python streaming chunks
- Added `function_call` type support (Llama 3.2 variant)
- Created obfuscated test tools (`get_flumbuster`, `calculate_zorbix`)
- Added `--test-tools` CLI flag
- 58 unit tests, 476 total tests passing

### Contract Improvements
- Strengthened minimal contract to reject empty string arguments
- Added validation in `ChatEngine._execute_tool_by_name()` to reject empty required args
- Generic example in contract (no tool-specific examples to avoid training data leakage)

## Findings

### Model Compatibility
| Model | Works with Contract | Notes |
|-------|---------------------|-------|
| Hermes 3 8B | Yes | Recommended - follows instructions well |
| Llama 3.2 3B | Partial | Outputs JSON but ignores "ask for missing args" |
| Mistral 7B v0.3 | No | Ignores tools, responds conversationally |

### Key Insight
Smaller models (3B, 7B) don't follow complex contract instructions reliably. They either:
- Call tools with empty arguments instead of asking
- Ignore tools entirely

Hermes models are specifically fine-tuned for tool calling and work best.

## Blockers
None

## Next Steps
1. Confirm Hermes 8B works end-to-end with flumbuster test
2. Consider llama-cpp-python native tool calling mode for better model support
3. Test with larger models (70B+) for instruction following
4. E2E test suite with real models

## Files Changed
- `src/l3m_backend/engine/toolcall.py` (new)
- `src/l3m_backend/engine/chat.py` (validation, use ToolCallHandler)
- `src/l3m_backend/engine/contract.py` (strengthened)
- `src/l3m_backend/tools/test_tools.py` (new)
- `src/l3m_backend/cli/chat_repl.py` (--test-tools flag)
- `tests/test_toolcall.py` (new, 58 tests)
- `docs/plans/001-toolcall-module.md` (updated)
- `docs/hermes-toolcalling.md` (new)
